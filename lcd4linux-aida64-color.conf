Variables {
    colorCPU '00ff00'
    colorRAM 'ffff00'
    colorGPU '00ffff'
}

Display DPF {
    Driver     'DPF'
    Port       'usb0'
    Font       '12x16'
    Foreground 'ffffff'
    Background '000000'
    BaseColor  '000000'
    Orientation 0
    Backlight  7
}

# --- Widgets ---
Widget CPU_Label {
    class  'Text'
    expression 'CPU USAGE'
    width  10
    align  'L'
}
Widget CPU_Value {
    class  'Text'
    expression proc_stat::cpu('busy', 500)
    postfix '%'
    width  6
    precision 1
    align  'R'
}
Widget CPU_Bar {
    class 'Bar'
    expression  proc_stat::cpu('busy', 500)
    length 38
    direction 'E'
    update 500
    BarColor0 colorCPU
}

Widget RAM_Label {
    class  'Text'
    expression 'MEM USAGE'
    width  10
    align  'L'
}
Widget RAM_Value {
    class  'Text'
    expression (meminfo('MemTotal') - meminfo('MemAvailable')) / 1048576
    postfix 'GB'
    width  10
    precision 1
    align  'R'
}
Widget RAM_Bar {
    class 'Bar'
    expression (meminfo('MemTotal') - meminfo('MemAvailable')) * 100 / meminfo('MemTotal')
    length 38
    direction 'E'
    update 1000
    BarColor0 colorRAM
}

Widget GPU_Label {
    class  'Text'
    expression 'NVIDIA TESLA P4'
    width  20
    align  'L'
}
Widget GPU_Value {
    class  'Text'
    expression exec('nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits 2>/dev/null || echo 0', 2000)
    prefix 'Load:'
    postfix '%'
    width  10
    align  'R'
}
Widget GPU_Temp {
    class  'Text'
    expression exec('nvidia-smi --query-gpu=temperature.gpu --format=csv,noheader,nounits 2>/dev/null || echo 0', 2000)
    prefix 'Temp:'
    postfix 'C'
    width  10
    align  'R'
}
Widget GPU_Bar {
    class 'Bar'
    expression exec('nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits 2>/dev/null || echo 0', 2000)
    length 38
    direction 'E'
    update 2000
    BarColor0 colorGPU
}

Widget Divider {
    class 'Text'
    expression '----------------------------------------'
    width 40
}
Widget Uptime {
    class 'Text'
    expression uptime('%d days %H:%M')
    prefix 'UPTIME: '
    width 20
}

# --- Layout (Shifted down by 2 rows) ---
Layout Default {
    # Row 1, 2 are empty
    Row3 {
        Col1  'CPU_Label'
        Col31 'CPU_Value'
    }
    Row4 {
        Col1  'CPU_Bar'
    }
    Row6 {
        Col1  'RAM_Label'
        Col31 'RAM_Value'
    }
    Row7 {
        Col1  'RAM_Bar'
    }
    Row9 {
        Col1  'GPU_Label'
    }
    Row10 {
        Col1  'GPU_Value'
        Col25 'GPU_Temp'
    }
    Row11 {
        Col1  'GPU_Bar'
    }
    Row13 {
        Col1  'Divider'
    }
    Row14 {
        Col1  'Uptime'
    }
}

Display 'DPF'
Layout  'Default'
