Display DPF {
    Driver     'DPF'
    Port       'usb0'
    Font       '12x16'
    Foreground 'ffffff'
    Background '000000'
    BaseColor  '000000'
    Orientation 0
    Backlight  7
}

# --- CPU SECTION ---
Widget CPU_Label {
    class  'Text'
    expression 'CPU USAGE'
    width  10
    align  'L'
}
Widget CPU_Value {
    class  'Text'
    expression proc_stat::cpu('busy', 500)
    postfix '%'
    width  6
    precision 1
    align  'R'
}
Widget CPU_Bar {
    class 'Bar'
    expression  proc_stat::cpu('busy', 500)
    length 38
    direction 'E'
    update 500
}

# --- RAM SECTION ---
Widget RAM_Label {
    class  'Text'
    expression 'MEM USAGE'
    width  10
    align  'L'
}
Widget RAM_Value {
    class  'Text'
    expression (meminfo('MemTotal') - meminfo('MemAvailable')) / 1024
    postfix 'MB'
    width  10
    precision 0
    align  'R'
}
Widget RAM_Bar {
    class 'Bar'
    expression (meminfo('MemTotal') - meminfo('MemAvailable')) * 100 / meminfo('MemTotal')
    length 38
    direction 'E'
    update 1000
}

# --- GPU SECTION (Tesla P4) ---
Widget GPU_Label {
    class  'Text'
    expression 'NVIDIA TESLA P4'
    width  20
    align  'L'
}
Widget GPU_Value {
    class  'Text'
    expression exec('nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits 2>/dev/null || echo 0', 2000)
    prefix 'Load:'
    postfix '%'
    width  10
    align  'R'
}
Widget GPU_Temp {
    class  'Text'
    expression exec('nvidia-smi --query-gpu=temperature.gpu --format=csv,noheader,nounits 2>/dev/null || echo 0', 2000)
    prefix 'Temp:'
    postfix 'C'
    width  10
    align  'R'
}
Widget GPU_Bar {
    class 'Bar'
    expression exec('nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits 2>/dev/null || echo 0', 2000)
    length 38
    direction 'E'
    update 2000
}

# --- FOOTER ---
Widget Divider {
    class 'Text'
    expression '----------------------------------------'
    width 40
}
Widget Uptime {
    class 'Text'
    expression uptime('%d days %H:%M')
    prefix 'UPTIME: '
    width 20
}

# --- LAYOUT ---
Layout Default {
    Row1 {
        Col1  'CPU_Label'
        Col31 'CPU_Value'
    }
    Row2 {
        Col1  'CPU_Bar'
    }
    Row4 {
        Col1  'RAM_Label'
        Col31 'RAM_Value'
    }
    Row5 {
        Col1  'RAM_Bar'
    }
    Row7 {
        Col1  'GPU_Label'
    }
    Row8 {
        Col1  'GPU_Value'
        Col25 'GPU_Temp'
    }
    Row9 {
        Col1  'GPU_Bar'
    }
    Row11 {
        Col1  'Divider'
    }
    Row12 {
        Col1  'Uptime'
    }
}

Display 'DPF'
Layout  'Default'
